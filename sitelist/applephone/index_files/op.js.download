(function($){'use strict';String.prototype.lcfirst=function(){var str=this;if(str.length){str=str.charAt(0).toLowerCase()+ str.slice(1);}
return str;};function variationMatches(variationAttributes,attributes){if(typeof variationAttributes=='object'&&typeof attributes=='object'){var size=0,match=0,key;for(key in variationAttributes){if(variationAttributes.hasOwnProperty(key)){if(variationAttributes[key]==''||variationAttributes[key]==attributes[key]){match++;}
size++;}}
return match==size;}else{return false;}}
function mordaSlider(){var Slider=function(slider){var slider=slider,swiper=slider.data('swiper'),timeout=null;function onSlide(){var slide=slider.find('.su-slider-slide-active'),slideAutoplay=slide.data('mordas_autoplay')||0;if(slideAutoplay>0){swiper.stopAutoplay();timeout=setTimeout(function(){timeout=null;swiper.startAutoplay();},slideAutoplay);}
if(slide.find('video').length){var video=slide.find('video')[0];if(video.currentTime==0){video.play();}}
slide.siblings('.su-slider-slide').each(function(){var v=$(this).find('video');if(v.length){v[0].currentTime=0;}});}
swiper.addCallback('SlideChangeEnd',onSlide);}
if(window.matchMedia("(min-width: 768px)").matches){$('.mordaslider').each(function(){$('.video-container',this).each(function(){var t=$(this),video=$('<video muted preload></video>'),sources=t.data('src');if(window.matchMedia("(min-width: 1024px)").matches){video.attr('src',sources.large);}else{video.attr('src',sources.medium);}
t.append(video);});});}
setTimeout(function(){var mordaslider=$('.mordaslider:first');if(mordaslider.length&&mordaslider.data('swiper')){Slider(mordaslider);}},2000);}
$(function(){window.menuScroll=function(id,duration){var menu_height=$('#masthead .header-menu').outerHeight()+ $('#wpadminbar').outerHeight(),target=$(id);if(target.length){if(typeof duration=='undefined'){duration=500;}
$.scrollTo(target,{duration:duration,offset:-menu_height});}}
mordaSlider();$('#site-navigation .scrollto.current_page_item a, #site-navigation .scrolltoh a, a.scroll-link').on('click',function(e){e.preventDefault();menuScroll(this.href.substring(this.href.indexOf('#')));});var adjust_slider_timeout=false,adjust_slider=function($sly){var $frame=$sly.find('.frame').eq(0),$slidee=$frame.children('.slidee').eq(0),width=0;$slidee.children().each(function(){width=width+ $(this).outerWidth()+ 1;});$slidee.width(width);},adjust_sliders=function(){$('.sly').each(function(){adjust_slider($(this));});};$(window).on('resize',function(){if(adjust_slider_timeout)clearTimeout(adjust_slider_timeout);adjust_slider_timeout=setTimeout(adjust_sliders,700);});adjust_sliders();$('.op-filter .nav-pills li').on('click',function(){var $this=$(this),$filter=$this.closest('.op-filter'),req={action:'op_ajax_slides',cat:$filter.data('cat'),tags:[],tpl:$filter.data('tpl')||''};$this.addClass('active').siblings().removeClass('active');var next_nav=$this.parent().next('ul[data-tax]');next_nav.children('li').removeClass('hidden');if($this.data('disable')){var disable=($this.data('disable')+'').split(' ');if(disable.length){disable.forEach(function(slug){next_nav.find('li[data-slug='+ slug+']').removeClass('active').addClass('hidden');});if(next_nav.children('li.active').length==0){next_nav.children().not('.hidden').first().addClass('active');}}}
$filter.find('ul[data-tax=tag] > li.active').each(function(){req.tags.push($(this).data('slug'));});$.post(woocommerce_params.ajax_url,req,function(data){var $target=$($filter.data('target')),$slidee=$target.find('.slidee');$slidee.html(data);adjust_slider($target);$target.trigger('op.sliderload');});});$('.sly, .option-select').on('click','.variations-list > li',function(){var $t=$(this),$form=$t.closest('form.variations_form'),attribute_name=$t.parent().data('attribute_name'),attribute_value=$t.data('value'),variations=$form.data('product_variations'),option_select=$t.closest('.option-select'),attributes={},enabled_attrs={},in_sly=$t.closest('.sly').length>0,variation=null,product_id=$form.data('product_id');$t.parent().find('li').removeClass('active');$t.addClass('active');$form.find('input[name="'+ attribute_name+'"]').val(attribute_value);if(option_select.length&&option_select.next().hasClass('option-select-disabled')){option_select.next().removeClass('option-select-disabled');}
var delivery_term='В наличии',term_parent=in_sly?$form.closest('.price-btn'):$form.closest('.summary'),term_el=term_parent.find('.delivery-term');if($form.find('ul.variations-list:first').data('attribute_name')==attribute_name){var key='';variations.forEach(function(v){if(v.attributes[attribute_name]==attribute_value){for(key in v.attributes){if(key==attribute_name){continue;}
if(!(key in enabled_attrs)){enabled_attrs[key]={};}
if(!(v.attributes[key]in enabled_attrs[key])){enabled_attrs[key][v.attributes[key]]=true;}}}});$form.find('ul.variations-list').slice(1).each(function(){var att_name=$(this).data('attribute_name');$(this).children().each(function(){var $var_li=$(this);if(!($var_li.data('value')in enabled_attrs[att_name])){$var_li.addClass('hidden');if($var_li.is('.active')){$var_li.removeClass('active');$form.find('input[name="'+ att_name+'"]').val('');if($form.closest('.slidee').is('.macbook')){$form.find('.variation-description .vcenter').html('Выберите опцию');$form.find('.variation-description').removeClass('active');$form.find('.single_add_to_cart_button').html($form.find('.single_add_to_cart_button').data('default_price'));}
$('#main > .product .product_meta .sku').text('N/A');$form.find('.single_add_to_cart_button').attr('disabled','disabled');}}else{$var_li.removeClass('hidden');}});});}
$form.find('.variations-list').each(function(){attributes[$(this).data('attribute_name')]=$(this).children('.active').data('value');});for(var i=0;i<variations.length;++i){if(variationMatches(variations[i].attributes,attributes)){variation=variations[i];break;}}
if(variation!=null){$form.find('.variation_id').val(variation.variation_id);if(variation.price_html){$form.find('.single_add_to_cart_button').html(variation.price_html);}
if($form.closest('.slidee').is('.macbook')){$form.find('.variation-description .vcenter').html(variation.variation_description);$form.find('.variation-description').addClass('active');}
$form.find('.single_add_to_cart_button').removeAttr('disabled');var $product_panel=$form.closest('.product');if(!in_sly&&$product_panel.length){var $product_title=$product_panel.find('h1.product_title'),$product_sku=$product_panel.find('.product_meta .sku');$product_title.text(variation._variation_title?variation._variation_title:$product_title.data('product-title'));$product_sku.text(variation.sku?variation.sku:'N/A');}
if(variation.display_price==0){delivery_term='';}else if(variation.op_delivery=='preorder'){delivery_term='Предзаказ';}else if(variation.op_delivery=='after3'){delivery_term='Доставка 1-3 дня';}else if(variation.op_delivery=='after5'){delivery_term='Доставка 3-5 дней';}}else{$form.find('.single_add_to_cart_button').attr('disabled','disabled');}
if(attribute_name=='attribute_pa_color'){for(var i=0;i<variations.length;++i){if(variations[i].attributes[attribute_name]==attribute_value){if(variations[i].image_src){$('.sly-constructor .sly-product-'+ product_id+' .sly-thumbnail img').attr('src',variations[i].image_src).attr('srcset',variations[i].image_srcset).attr('sizes',variations[i].image_sizes);var product_img=$t.closest('.product').find('.images img').eq(0);if(!in_sly&&product_img.length){product_img.attr('src',variations[i].image_src).attr('srcset',variations[i].image_srcset).attr('sizes',variations[i].image_sizes).attr('alt',variations[i].image_title).attr('title',variations[i].image_title).parent().attr('href',variations[i].image_link);}}
break;}}}
if(term_el.length){term_el.text(delivery_term);}else{term_parent.append('<div class="delivery-term">'+ delivery_term+'</div>');}
$form.trigger('op.variation.changed');});var stick_h=$('#masthead').outerHeight()/ 2,
applyStick=function(){if($(window).scrollTop()>stick_h){$('body').addClass('sticky-head');}else{$('body').removeClass('sticky-head');}};$(window).on('scroll',applyStick);applyStick();$('.cart .update-cart').on('click',function(e){e.preventDefault();$(this).closest('form').submit();});$('.entry-content').on('click','.cart .quantity .spinner',function(e){e.preventDefault();var $t=$(this),$input=$t.siblings('input'),qty=$input.val()- 0;if($t.is('.qty-minus')){if(qty==1)return;qty--;}else{qty++;}
$input.val(qty);$input.trigger('change');});var updateCartTimeout=false,updateCart=function(){var $form=$('.woocommerce form');$.post($form.attr('href'),$form.serialize(),function(data){$('.entry-content .woocommerce').replaceWith($(data).find('.entry-content .woocommerce'));console.log('cart updated');});};$('.entry-content').on('change','input.qty',function(){if(updateCartTimeout)clearTimeout(updateCartTimeout);updateCartTimeout=setTimeout(updateCart,800);});$('#masthead .menu-toggle').on('click',function(){if($(this).attr('aria-expanded')=='false'){$('#site-navigation .handheld-navigation').height(0);$('body').removeClass('nav-expanded');}else{$('#site-navigation .handheld-navigation').height($(window).height()- 42);$('body').addClass('nav-expanded');}});$('input.masked-input').each(function(){$(this).mask($(this).data('mask'));});$('.site-footer .show-map').on('click',function(){if(!$('#ymap').data('initialized')){ymaps.ready(function(){var map=new ymaps.Map("ymap",{center:[55.741288,37.502592],zoom:15});var mark=new ymaps.Placemark([55.741288,37.502592],{hintContent:'Магазин OnlyPhones',balloonContent:'ТЦ Горбушка, магазин 171'});map.geoObjects.add(mark);});$('#ymap').data('initialized',true);}});$(document.body).on('updated_checkout',function(){var selected_shipping=$('#shipping_method input.shipping_method:checked'),shipping_id=selected_shipping.val(),shipping_cost=selected_shipping.data('cost'),shipping_label=selected_shipping.siblings('label').text(),selected_payment=$('#payment_select input[name=payment_method]:checked'),payment_id=selected_payment.val();if($('#billing_city_field > label > abbr').length==0){$('<abbr class="required" title="обязательно"> *</abbr>').appendTo($('#billing_email_field label, #billing_city_field label, #billing_address_1_field label'));}
if(payment_id=='pipo'){$('#billing_email_field').addClass('validate-required').show();}else{$('#billing_email_field').hide();}
if(shipping_id=='local_pickup'){$('#billing_city_field, #billing_address_1_field').hide();}else if(shipping_id=='international_delivery'){$('#billing_city_field, #billing_address_1_field').addClass('validate-required').show();}else{$('#billing_city_field').hide();$('#billing_address_1_field').addClass('validate-required').show();$('#shipping_delivery_time_field input').removeAttr('disabled');var hour=(new Date()).getHours();if(shipping_id=='flat_rate'&&hour<21){$('#shipping_delivery_time_field input').each(function(){if(/^\d+$/.test(this.value)&&hour>=this.value){$(this).attr('disabled','disabled').removeAttr('checked');}});}}
if(shipping_id=='international_delivery'){shipping_cost='Стоимость доставки будет названа нашим менеджером при подтверждении заказа';}else if(shipping_id=='free_shipping'){shipping_cost='Доставка '+ shipping_label.lcfirst()+' <span class="amount free">Бесплатно</span>';}else if(shipping_cost>0){shipping_cost='Доставка '+ shipping_label.lcfirst()+' <span class="amount">'+ shipping_cost+' ₽'+'</span>';}else{shipping_cost='';}
$('#shipping_cost').html(shipping_cost);});$('form.checkout').on('change','input[name="payment_method"]',function(){$('body').trigger('update_checkout');});function bounceEffect(el,times,distance,speed){times=typeof times!=='undefined'?times:2;distance=typeof distance!='undefined'?distance:'7px';speed=typeof speed!=='undefined'?speed:70;for(var i=0;i<times;i++){el.animate({marginLeft:'-='+ distance},speed).animate({marginLeft:'+='+ distance},speed);}}
function validateFormInput(){var $this=$(this),$parent=$this.closest('.form-row'),validated=true;if($parent.is('.validate-required')){if('checkbox'===$this.attr('type')&&!$this.is(':checked')){$parent.removeClass('woocommerce-validated').addClass('woocommerce-invalid woocommerce-invalid-required-field');validated=false;}else if($this.val()===''){$parent.removeClass('woocommerce-validated').addClass('woocommerce-invalid woocommerce-invalid-required-field');validated=false;}}
if($parent.is('.validate-email')){if($this.val()){var pattern=new RegExp(/^((([a-z]|\d|[!#\$%&'\*\+\-\/=\?\^_`{\|}~]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])+(\.([a-z]|\d|[!#\$%&'\*\+\-\/=\?\^_`{\|}~]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])+)*)|((\x22)((((\x20|\x09)*(\x0d\x0a))?(\x20|\x09)+)?(([\x01-\x08\x0b\x0c\x0e-\x1f\x7f]|\x21|[\x23-\x5b]|[\x5d-\x7e]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(\\([\x01-\x09\x0b\x0c\x0d-\x7f]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF]))))*(((\x20|\x09)*(\x0d\x0a))?(\x20|\x09)+)?(\x22)))@((([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.)+(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.?$/i);if(!pattern.test($this.val())){$parent.removeClass('woocommerce-validated').addClass('woocommerce-invalid woocommerce-invalid-email');validated=false;}}}
if(validated){$parent.removeClass('woocommerce-invalid woocommerce-invalid-required-field').addClass('woocommerce-validated');}}
$('.validate-form').on('blur change','.input-text, select',validateFormInput);$('.validate-form').on('submit',function(e){var $f=$(this);$f.find('.input-text, select').each(validateFormInput);if($f.find('.woocommerce-invalid:first').length){e.preventDefault();bounceEffect($f.find('.button[type=submit]'));$f.addClass('form-invalid').removeClass('form-valid');}else{$f.removeClass('form-invalid').addClass('form-valid');}});$('#service_form form').on('submit',function(e){var $f=$(this);e.preventDefault();if($f.is('.form-valid')){var req=$f.serializeArray();req.push({name:'action',value:'op_ajax_form'});$f.block({message:null,overlayCSS:{background:'#fff',opacity:0.6}});$.post(woocommerce_params.ajax_url,$.param(req),function(data){var resultElement=$f.find('.form-result');if(typeof data.result!='undefined'){resultElement.html(data.message);if(data.result){resultElement.removeClass('error').addClass('success');$f.find('.input-text').val('');}else{resultElement.removeClass('success').addClass('error')}}else{resultElement.removeClass('success').addClass('error').text('К сожалению, при отправке формы произошла ошибка. Пожалуйста, оставьте заявку по телефону.');}
$f.unblock();});}});$('.site-footer .widget > h3').on('click',function(e){$(this).closest('.widget').toggleClass('open');});});$(window).load(function(){if(window.location.hash){menuScroll(window.location.hash);}});})(jQuery);